!function(){"use strict";var e,t,n,i,o,s={},r=[],l=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function c(e,t){for(var n in t)e[n]=t[n];return e}function _(e){var t=e.parentNode;t&&t.removeChild(e)}function u(e,t,n){var i,o=arguments,s={};for(i in t)"key"!==i&&"ref"!==i&&(s[i]=t[i]);if(arguments.length>3)for(n=[n],i=3;i<arguments.length;i++)n.push(o[i]);if(null!=n&&(s.children=n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===s[i]&&(s[i]=e.defaultProps[i]);return a(e,s,t&&t.key,t&&t.ref)}function a(t,n,i,o){var s={type:t,props:n,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0};return e.vnode&&e.vnode(s),s}function p(e){return e.children}function h(e,t){this.props=e,this.context=t}function d(e,t){if(null==t)return e.__?d(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?d(e):null}function f(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return f(e)}}function v(o){(!o.__d&&(o.__d=!0)&&1===t.push(o)||i!==e.debounceRendering)&&((i=e.debounceRendering)||n)(y)}function y(){var e,n,i,o,s,r,l;for(t.sort((function(e,t){return t.__v.__b-e.__v.__b}));e=t.pop();)e.__d&&(i=void 0,o=void 0,r=(s=(n=e).__v).__e,(l=n.__P)&&(i=[],o=S(l,s,c({},s),n.__n,void 0!==l.ownerSVGElement,null,i,null==r?d(s):r),x(i,s),o!=r&&f(s)))}function m(e,t,n,i,o,l,c,u,a){var p,h,f,v,y,m,k,b=n&&n.__k||r,w=b.length;if(u==s&&(u=null!=l?l[0]:w?d(n,0):null),p=0,t.__k=g(t.__k,(function(n){if(null!=n){if(n.__=t,n.__b=t.__b+1,null===(f=b[p])||f&&n.key==f.key&&n.type===f.type)b[p]=void 0;else for(h=0;h<w;h++){if((f=b[h])&&n.key==f.key&&n.type===f.type){b[h]=void 0;break}f=null}if(v=S(e,n,f=f||s,i,o,l,c,u,a),(h=n.ref)&&f.ref!=h&&(k||(k=[]),f.ref&&k.push(f.ref,null,n),k.push(h,n.__c||v,n)),null!=v){var r;if(null==m&&(m=v),void 0!==n.__d)r=n.__d,n.__d=void 0;else if(l==f||v!=u||null==v.parentNode){e:if(null==u||u.parentNode!==e)e.appendChild(v),r=null;else{for(y=u,h=0;(y=y.nextSibling)&&h<w;h+=2)if(y==v)break e;e.insertBefore(v,u),r=u}"option"==t.type&&(e.value="")}u=void 0!==r?r:v.nextSibling,"function"==typeof t.type&&(t.__d=u)}else u&&f.__e==u&&u.parentNode!=e&&(u=d(f))}return p++,n})),t.__e=m,null!=l&&"function"!=typeof t.type)for(p=l.length;p--;)null!=l[p]&&_(l[p]);for(p=w;p--;)null!=b[p]&&L(b[p],b[p]);if(k)for(p=0;p<k.length;p++)C(k[p],k[++p],k[++p])}function g(e,t,n){if(null==n&&(n=[]),null==e||"boolean"==typeof e)t&&n.push(t(null));else if(Array.isArray(e))for(var i=0;i<e.length;i++)g(e[i],t,n);else n.push(t?t("string"==typeof e||"number"==typeof e?a(null,e,null,null):null!=e.__e||null!=e.__c?a(e.type,e.props,e.key,null):e):e);return n}function k(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]="number"==typeof n&&!1===l.test(t)?n+"px":null==n?"":n}function b(e,t,n,i,o){var s,r,l,c,_;if(o?"className"===t&&(t="class"):"class"===t&&(t="className"),"key"===t||"children"===t);else if("style"===t)if(s=e.style,"string"==typeof n)s.cssText=n;else{if("string"==typeof i&&(s.cssText="",i=null),i)for(r in i)n&&r in n||k(s,r,"");if(n)for(l in n)i&&n[l]===i[l]||k(s,l,n[l])}else"o"===t[0]&&"n"===t[1]?(c=t!==(t=t.replace(/Capture$/,"")),_=t.toLowerCase(),t=(_ in e?_:t).slice(2),n?(i||e.addEventListener(t,w,c),(e.l||(e.l={}))[t]=n):e.removeEventListener(t,w,c)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&"size"!==t&&!o&&t in e?e[t]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/^xlink:?/,""))?null==n||!1===n?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(t)?e.removeAttribute(t):e.setAttribute(t,n))}function w(t){this.l[t.type](e.event?e.event(t):t)}function S(t,n,i,o,s,r,l,_,u){var a,d,f,v,y,g,k,b,w,S,x=n.type;if(void 0!==n.constructor)return null;(a=e.__b)&&a(n);try{e:if("function"==typeof x){if(b=n.props,w=(a=x.contextType)&&o[a.__c],S=a?w?w.props.value:a.__:o,i.__c?k=(d=n.__c=i.__c).__=d.__E:("prototype"in x&&x.prototype.render?n.__c=d=new x(b,S):(n.__c=d=new h(b,S),d.constructor=x,d.render=M),w&&w.sub(d),d.props=b,d.state||(d.state={}),d.context=S,d.__n=o,f=d.__d=!0,d.__h=[]),null==d.__s&&(d.__s=d.state),null!=x.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=c({},d.__s)),c(d.__s,x.getDerivedStateFromProps(b,d.__s))),v=d.props,y=d.state,f)null==x.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==x.getDerivedStateFromProps&&b!==v&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(b,S),!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(b,d.__s,S)){for(d.props=b,d.state=d.__s,d.__d=!1,d.__v=n,n.__e=i.__e,n.__k=i.__k,d.__h.length&&l.push(d),a=0;a<n.__k.length;a++)n.__k[a]&&(n.__k[a].__=n);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(b,d.__s,S),null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(v,y,g)}))}d.context=S,d.props=b,d.state=d.__s,(a=e.__r)&&a(n),d.__d=!1,d.__v=n,d.__P=t,a=d.render(d.props,d.state,d.context),n.__k=null!=a&&a.type==p&&null==a.key?a.props.children:Array.isArray(a)?a:[a],null!=d.getChildContext&&(o=c(c({},o),d.getChildContext())),f||null==d.getSnapshotBeforeUpdate||(g=d.getSnapshotBeforeUpdate(v,y)),m(t,n,i,o,s,r,l,_,u),d.base=n.__e,d.__h.length&&l.push(d),k&&(d.__E=d.__=null),d.__e=!1}else n.__e=$(i.__e,n,i,o,s,r,l,u);(a=e.diffed)&&a(n)}catch(t){e.__e(t,n,i)}return n.__e}function x(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(e){e.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function $(e,t,n,i,o,l,c,_){var u,a,p,h,d,f=n.props,v=t.props;if(o="svg"===t.type||o,null!=l)for(u=0;u<l.length;u++)if(null!=(a=l[u])&&((null===t.type?3===a.nodeType:a.localName===t.type)||e==a)){e=a,l[u]=null;break}if(null==e){if(null===t.type)return document.createTextNode(v);e=o?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type,v.is&&{is:v.is}),l=null}if(null===t.type)f!==v&&e.data!=v&&(e.data=v);else if(t!==n){if(null!=l&&(l=r.slice.call(e.childNodes)),p=(f=n.props||s).dangerouslySetInnerHTML,h=v.dangerouslySetInnerHTML,!_){if(f===s)for(f={},d=0;d<e.attributes.length;d++)f[e.attributes[d].name]=e.attributes[d].value;(h||p)&&(h&&p&&h.__html==p.__html||(e.innerHTML=h&&h.__html||""))}(function(e,t,n,i,o){var s;for(s in n)s in t||b(e,s,null,n[s],i);for(s in t)o&&"function"!=typeof t[s]||"value"===s||"checked"===s||n[s]===t[s]||b(e,s,t[s],n[s],i)})(e,v,f,o,_),t.__k=t.props.children,h||m(e,t,n,i,"foreignObject"!==t.type&&o,l,c,s,_),_||("value"in v&&void 0!==v.value&&v.value!==e.value&&(e.value=null==v.value?"":v.value),"checked"in v&&void 0!==v.checked&&v.checked!==e.checked&&(e.checked=v.checked))}return e}function C(t,n,i){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,i)}}function L(t,n,i){var o,s,r;if(e.unmount&&e.unmount(t),(o=t.ref)&&(o.current&&o.current!==t.__e||C(o,null,n)),i||"function"==typeof t.type||(i=null!=(s=t.__e)),t.__e=t.__d=void 0,null!=(o=t.__c)){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(t){e.__e(t,n)}o.base=o.__P=null}if(o=t.__k)for(r=0;r<o.length;r++)o[r]&&L(o[r],n,i);null!=s&&_(s)}function M(e,t,n){return this.constructor(e,n)}e={__e:function(e,t){for(var n,i;t=t.__;)if((n=t.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(i=!0,n.setState(n.constructor.getDerivedStateFromError(e))),null!=n.componentDidCatch&&(i=!0,n.componentDidCatch(e)),i)return v(n.__E=n)}catch(t){e=t}throw e}},h.prototype.setState=function(e,t){var n;n=this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof e&&(e=e(n,this.props)),e&&c(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),v(this))},h.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),v(this))},h.prototype.render=p,t=[],n="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,o=s;var E=function(e,t,n,i){var o;t[0]=0;for(var s=1;s<t.length;s++){var r=t[s++],l=t[s]?(t[0]|=r?1:2,n[t[s++]]):t[++s];3===r?i[0]=l:4===r?i[1]=Object.assign(i[1]||{},l):5===r?(i[1]=i[1]||{})[t[++s]]=l:6===r?i[1][t[++s]]+=l+"":r?(o=e.apply(l,E(e,l,n,["",null])),i.push(o),l[0]?t[0]|=2:(t[s-2]=0,t[s]=o)):i.push(l)}return i},N=new Map;var P=function(e){var t=N.get(this);return t||(t=new Map,N.set(this,t)),(t=E(this,t.get(e)||(t.set(e,t=function(e){for(var t,n,i=1,o="",s="",r=[0],l=function(e){1===i&&(e||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?r.push(0,e,o):3===i&&(e||o)?(r.push(3,e,o),i=2):2===i&&"..."===o&&e?r.push(4,e,0):2===i&&o&&!e?r.push(5,0,!0,o):i>=5&&((o||!e&&5===i)&&(r.push(i,0,o,n),i=6),e&&(r.push(i,e,0,n),i=6)),o=""},c=0;c<e.length;c++){c&&(1===i&&l(),l(c));for(var _=0;_<e[c].length;_++)t=e[c][_],1===i?"<"===t?(l(),r=[r],i=3):o+=t:4===i?"--"===o&&">"===t?(i=1,o=""):o=t+o[0]:s?t===s?s="":o+=t:'"'===t||"'"===t?s=t:">"===t?(l(),i=1):i&&("="===t?(i=5,n=o,o=""):"/"===t&&(i<5||">"===e[c][_+1])?(l(),3===i&&(r=r[0]),i=r,(r=r[0]).push(2,0,i),i=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(l(),i=2):o+=t),3===i&&"!--"===o&&(i=4,r=r[0])}return l(),r}(e)),t),arguments,[])).length>1?t:t[0]}.bind(u);class D extends h{render({condition:e,children:t}){return t instanceof Array||(t=[t]),e?t.filter(e=>e.type!==U):t.filter(e=>e.type===U)}}class U extends h{render({children:e}){return e}}const z={raise:"✋",yes:"👍",no:"👎",speaker:"🔈",problem:"⚠️"},T=Object.entries(z);let W=window.location.pathname.split("/").pop().toLowerCase(),A=new class{constructor({path:e="/",url:t}={}){this.path=e,this.url=t,this.connect(),this.connected=!1,this.ping=null,this._listeners={message:new Set,open:new Set,close:new Set}}connect(){let e="ws://";"https:"===location.protocol&&(e="wss://");let t=this.url||e+location.host+this.path;this.socket=new WebSocket(t),this.socket.addEventListener("open",e=>{this.connected=!0,this._emit("open")}),this.socket.addEventListener("close",e=>{this.connected=!1,this._emit("close"),setTimeout(()=>this.connect(),2e3)}),this.socket.addEventListener("message",e=>{this._emit("message",e.data)}),clearInterval(this.ping),this.ping=setInterval(()=>this.send("ping"),5e3)}_emit(e,t){this._listeners[e].forEach(e=>{try{e(t)}catch(e){console.warn("error in message handler",e)}})}on(e,t){e in this._listeners&&this._listeners[e].add(t)}off(e,t){"message"===e&&this.messageHandlers.delete(t)}send(e){this.connected&&("object"==typeof e?this.socket.send(JSON.stringify(e)):this.socket.send(e))}};!function(t,n,i){var l,c,_;e.__&&e.__(t,n),c=(l=i===o)?null:i&&i.__k||n.__k,t=u(p,null,[t]),_=[],S(n,(l?n:i||n).__k=t,c||s,s,void 0!==n.ownerSVGElement,i&&!l?[i]:c?null:r.slice.call(n.childNodes),_,i||s,l),x(_,t)}(P`<${class extends h{constructor(e){super(e);let t=new URL(window.location);t.pathname="/r/"+this.props.room,this.state={status:null,connected:!1,participants:[],size:0,inviteURL:t,height:window.innerHeight+"px"},this.safety=0,this.holder={},this.invite={},this.props.socket.on("close",e=>this.setState({connected:!1})),this.props.socket.on("open",e=>{this.setState({connected:!0}),this.props.socket.send({type:"host",room:this.props.room})}),this.props.socket.on("message",e=>this.handleMessage(e)),window.addEventListener("resize",e=>{this.setState({height:window.innerHeight+"px"}),this.getSize()})}handleMessage(e){try{e=JSON.parse(e)}catch(e){return void console.warn(e)}"update"===e.type&&this.setState({participants:e.data})}copyInvite(e){e.preventDefault(),this.invite.current&&(this.invite.current.select(),document.execCommand("copy"),console.log("copied invite link"))}getSize(){if(this.safety<1e5&&this.holder.current){let e=this.holder.current.offsetWidth,t=this.holder.current.offsetHeight,n=this.state.participants.filter(e=>e.status).length;if(n&&t){let i=function(e,t,n,i,o,s){let r=e/t,l=0,c=1/0;for(let e=1;e<=o;e++){let t=(e*(n+s)+s)/(Math.ceil(o/e)*(i+s)+s),_=Math.abs(t-r);_<c&&(l=e,c=_)}return l}(e,t,4,3,n,1),o=Math.ceil(n/i),s=Math.min(e/i/9,t/o/7);s!==this.state.size&&(this.safety++,this.setState({size:s}))}}}componentDidUpdate(){this.getSize()}componentDidMount(){this.getSize()}render({room:e},{participants:t=[],connected:n,size:i,inviteURL:o,height:s="100%"}){return P`
      <div class="app host" style="height:${s}">
        <header>
          <div class="room">
            <div>#<b>${e}</b></div>
            <input class="join" value=${o} ref=${this.invite} />
            <button class="link" onClick=${e=>this.copyInvite(e)}>
              copy invite
            </button>
            <a href="${o}">participant mode</a>
          </div>
          <${D} condition=${n}>
            <div class="connection connected">
              <span>✅ connected as host</span>
            </div>
            <${U}>
              <div class="connection connecting">
                🔌 connecting
              </div>
            </>
          </>
        </header>
        <div class="participants" ref=${this.holder}>
          <div class="layout" style="font-size:${i}px">
            ${t.filter(e=>e.status).map(e=>P`
              <div class="participant">
                <div class="participant-status">${e.status?z[e.status]:""}</div>
                <div class="participant-name">${e.name}</div>
              </div>
            `)}
          </div>
        </div>
        <footer>
          <div class="count">
            ${t.length}
            ${1===t.length?" participant":" participants"}
          </div>
          <div class="stats">
            ${T.map(([e,n])=>P`
              <div>${n}×${t.filter(t=>t.status===e).length}</div>
            `)}
          </div>
          <div class="actions">
            <button>clear all</button>
          </div>
        </footer>
      </div>
    `}}} socket=${A} room=${W}/>`,document.body)}();
//# sourceMappingURL=host.bundle.js.map
